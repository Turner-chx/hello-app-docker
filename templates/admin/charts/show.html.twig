{% extends '@EasyAdminExtension/default/layout.html.twig' %}
{% block main %}
    <div class="container">
        {{ form_start(form)}}
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    {{ form_row(form.dateStart) }}
                </div>
                <div class="col-sm-6">
                    {{ form_row(form.dateEnd) }}
                </div>
            </div>
            {{ form_row(form.setting) }}
            {{ form_row(form.submit) }}
        </div>
        {{ form_end(form) }}
        <div id="status_pie" style="width:100%; height:400px;"></div>
        {% for key,data in datas %}
            {% if key != 'title' %}
        <div id="status_pie_{{ key }}" style="width:100%; height:400px;"></div>
            {% endif %}
        {% endfor %}
    </div>

{% endblock %}
{% block body_javascript %}
    {{ parent() }}
    <script src="{{ asset('js/highcharts.min.js') }}"></script>
    <script>
        Highcharts.chart('status_pie', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Graphique des Ã©tats'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.y}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: false
                    },
                    showInLegend: true
                }
            },
            series: [{
                name: 'Pourcentage',
                colorByPoint: true,
                data: [
                    {% for key, serie in series %}
                    {
                        name: '{{ key }}',
                        y: {{ serie }},
                        sliced: true,
                        selected: true
                    },
                    {% endfor %}
                ]
            }]
        });
        {% if datas | length > 0 %}
        {% set title = datas.title %}
        {% endif %}
        {% for key,data in datas %}
        {% if key != 'title' %}
        Highcharts.chart('status_pie_{{ key }}', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Graphique des {{ key }}: <br>{{ title }}'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.y}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: false
                    },
                    showInLegend: true
                }
            },
            series: [{
                name: 'Pourcentage',
                colorByPoint: true,
                data: [
                    {% for index,value in data %}
                    {
                        name: '{{ index|e('js')|raw }}',
                        y: {{ value|e('js')|raw }},
                        sliced: true,
                        selected: true
                    },
                    {% endfor %}
                ]
            }]
        });
        {% endif %}
        {% endfor %}
    </script>
{% endblock %}